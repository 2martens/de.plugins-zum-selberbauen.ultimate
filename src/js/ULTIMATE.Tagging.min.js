$.fn.extend({getCaret1:function(){if(this.is("input")){}else{if(!this.is("textarea")){return -1;}}var c=0;var b=this.get(0);if(document.selection){this.focus();var a=document.selection.createRange();a.moveStart("character",-this.val().length);c=a.text.length;}else{if(b.selectionStart||b.selectionStart=="0"){c=parseInt(b.selectionStart);}}return c;},setCaret1:function(b){if(this.is("input")){}else{if(!this.is("textarea")){return false;}}var c=this.get(0);this.focus();if(document.selection){var a=document.selection.createRange();a.moveStart("character",b);a.moveEnd("character",0);a.select();}else{if(c.selectionStart||c.selectionStart=="0"){c.selectionStart=b;c.selectionEnd=b;}}return true;}});ULTIMATE.Tagging={};ULTIMATE.Tagging.MultipleLanguageInput=WCF.MultipleLanguageInput.extend({_buttonList:null,_listList:null,_wrapperList:null,_elementList:null,_input:null,_hiddenInput:"",init:function(d,c,b,f,g){this._forceSelection=b;this._values=f;this._availableLanguages=g;this._buttonList={};this._listList={};this._wrapperList={};this._elementList={};this._input=$("#"+$.wcfEscapeID(c+"Real"));this._hiddenInput="#"+$.wcfEscapeID(c);for(var e in this._availableLanguages){$element=$("#"+$.wcfEscapeID(d+e));this._elementList[e]=$element;}this._languageID=LANGUAGE_ID;this._element=this._elementList[this._languageID];if(this._element.length==0){console.debug("[WCF.MultipleLanguageInput] element id '"+d+"' is unknown");return;}$(".tagContainer").hide();$("#tagContainer"+this._languageID).show();$(this._hiddenInput+this._languageID).hide();var a=($.getLength(this._values)>0)?true:false;this._insertedDataAfterInit=a;this._prepareElement(a);this._element.parents("form").submit($.proxy(this._submit,this));this._input.keyup($.proxy(this._inputChange,this));this._input.keydown($.proxy(this._inputKeydown,this));this._didInit=true;},_setVariables:function(){this._element=this._elementList[this._languageID];},_inputChange:function(b){var a=this._input.val();console.log("inputChange: "+a);$(this._hiddenInput+this._languageID).val(a);},_inputKeydown:function(b){var a=this._input.getCaret();$(this._hiddenInput+this._languageID).setCaret(a);$(this._hiddenInput+this._languageID).trigger(b);this._input.focus();if(b&&b.which==188){this._input.val("");}},_prepareElement:function(a){this._input.wrap('<div class="dropdown preInput" />');var c=this._input.parent();this._button=$('<p class="button dropdownToggle"><span>'+WCF.Language.get("wcf.global.button.disabledI18n")+"</span></p>").prependTo(c);this._list=$('<ul class="dropdownMenu"></ul>').insertAfter(this._button);if(this._button.nextAll("textarea").length){this._button.addClass("dropdownCaptionTextarea");}else{this._button.addClass("dropdownCaption");}for(var b in this._availableLanguages){$("<li><span>"+this._availableLanguages[b]+"</span></li>").data("languageID",b).click($.proxy(this._changeLanguage,this)).appendTo(this._list);}WCF.Dropdown.initDropdown(this._button,a);if(a||this._forceSelection){this._isEnabled=true;this._list.children("li").each($.proxy(function(d,f){var e=$(f);if(e.data("languageID")==this._languageID){e.trigger("click");}},this));}WCF.Dropdown.registerCallback(c.wcfIdentify(),$.proxy(this._handleAction,this));},_changeLanguage:function(a){var b=$(a.currentTarget);this._insertedDataAfterInit=true;$("#tagContainer"+this._languageID).hide();this._languageID=parseInt(b.data("languageID"));this._setVariables();$("#tagContainer"+this._languageID).show();$(this._hiddenInput+this._languageID).hide();b=this._list.children("li").filter(function(){return $(this).data("languageID")&&$(this).data("languageID")==this._languageID;});this._list.children("li").removeClass("active");b.addClass("active");this._button.children("span").addClass("active").text(this._availableLanguages[this._languageID]);if(this._didInit){this._input.blur().focus();}},_submit:function(){if(!this._isEnabled){return 3735928559;}}});ULTIMATE.Tagging.TagList=WCF.Tagging.TagList.extend({_languageID:0,init:function(d,a,b,c){this._languageID=c;this._super(d,a,b);},_keyDown:function(b){if(this._keyDown1(b)){if(b===null){return true;}var a=b.which;if(a===8||a===27||a===13||a===46){return true;}else{if(a>36&&a<41){return true;}}if(this._searchInput.val().length>=this._maxLength){return false;}return true;}return false;},_keyDown1:function(b){if(b===null||b.which===188){var a=$.trim(this._searchInput.val());if(b&&b.which===188){a=a.substring(0,this._searchInput.val().length);}if(a===""){return true;}this.addItem({objectID:0,label:a});if(b&&b.which===188){this._searchInput.val("");}else{this._searchInput.val("");}if(b!==null){b.stopPropagation();}return false;}return true;},_submit:function(){this._keyDown(null);var a=[];for(var c=0,b=this._data.length;c<b;c++){if(this._data[c]){a.push(this._data[c]);}}$('<input type="hidden" name="tags_i18n['+this._languageID+']" value="'+a.join(", ")+'" />').appendTo(this._form);}});