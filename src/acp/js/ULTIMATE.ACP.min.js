ULTIMATE.ACP={};ULTIMATE.ACP.Button={};ULTIMATE.ACP.Button.Replacement=function(b,a,c){this.init(b,a,c);};ULTIMATE.ACP.Button.Replacement.prototype={_button:null,_buttonValue:"",_checkElement:null,_initialValueDateTime:null,_lastValueDateTime:null,_initialStatusID:0,_action:"",_saveMap:{0:"ultimate.button.saveAsDraft",1:"ultimate.button.saveAsPending"},_publishMap:{0:"ultimate.button.publish",1:"ultimate.button.schedule",2:"ultimate.button.update"},init:function(b,a,c){this._button=$("#"+$.wcfEscapeID(b));this._buttonValue=this._button.val();this._checkElement=$("#"+$.wcfEscapeID(a));this._action=c;if(this._action=="save"){this._initialStatusID=this._checkElement.val();}else{if(this._action=="publish"){var d=this._checkElement.datetimepicker("getDate");this._initialValueDateTime=d;this._lastValueDateTime=d;}}this._checkElement.change($.proxy(this._change,this));this._change();},_change:function(){if(this._action=="save"){var e=this._checkElement.val();var d=WCF.Language.get(this._saveMap[e]);if(e>=2){this._button.attr("disabled","disabled").prop("disabled",true);this._button.addClass("ultimateHidden");}else{if(e==0||e==1){this._button.removeClass("ultimateHidden");this._button.removeAttr("disabled").prop("disabled",false);this._button.val(d);}}}else{if(this._action=="publish"){var f=this._checkElement.datetimepicker("getDate");var c=new Date();var b=WCF.Language.get(this._publishMap[2]);var a=(b==this._buttonValue);if(f>c){if(a&&(this._lastValueDateTime>c)){return;}if(a&&this._initialValueDateTime>c){this._button.val(b);}else{this._button.val(WCF.Language.get(this._publishMap[1]));}}else{if(a&&(this._lastValueDateTime<c)){return;}if(a&&this._initialValueDateTime<c){this._button.val(b);}else{this._button.val(WCF.Language.get(this._publishMap[0]));}}this._lastValueDateTime=f;}}}};ULTIMATE.ACP.Block={};ULTIMATE.ACP.Block.Transfer=function(b,a,c){this.init(b,a,c);};ULTIMATE.ACP.Block.Transfer.prototype={_element:null,_container:null,_containerID:"",_notification:null,_proxy:null,_optionList:[],_dialog:null,_editBlockID:0,init:function(b,a,c){this._element=$("#"+$.wcfEscapeID(b));this._container=$("#"+$.wcfEscapeID(a));this._containerID=$.wcfEscapeID(a);this._className=c;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$("#"+this._containerID).find('button[data-type="submit"]').click(function(d){d.preventDefault();});this._element.parent("form").submit($.proxy(this._stopFormSubmit,this));this._element.find('button[data-type="submit"]').click($.proxy(this._submit,this));this._init();},_init:function(){$(".jsBlock").on("remove",$.proxy(this._remove,this));$(".icon-pencil").not(".disabled").on("click",$.proxy(this._edit,this));},_stopFormSubmit:function(a){a.preventDefault();},_remove:function(a){var b=$("#"+this._containerID);if(b.find(".jsBlock").length<=1){b.find('button[data-type="submit"]').prop("disabled",true).addClass("disabled");}},_edit:function(g){var a=$(g.currentTarget);g.preventDefault();var d={};var c=a.data("objectID");this._editedBlockID=c;var f=$.extend(true,{data:{blockID:c}},{});var e=$.extend(true,{actionName:"getFormDataEditAJAX",className:this._className,parameters:f},d);var b=new WCF.Action.Proxy({success:$.proxy(this._successFormDataEdit,this)});b.setOption("data",e);b.sendRequest();},_submit:function(){var e={};var d=$("#selectBlocktype").val(),b=$("#selectBlocktypeError");if(d=="0"){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.form.error"),"error");this._element.find("dl:first").addClass("formError");var a='<small id="selectBlocktypeError" class="innerError">'+WCF.Language.get("wcf.acp.ultimate.template.selectBlocktype.error.notSelected")+"</small>";b.empty().remove();this._element.find("dl:first > dd").append(a);this._notification.show();return;}this._notification=null;b.empty().remove();var g=$.extend(true,{data:{blockTypeID:d}},{});var f=$.extend(true,{actionName:"getFormDataAJAX",className:this._className,parameters:g},e);var c=new WCF.Action.Proxy({success:$.proxy(this._successFormData,this)});c.setOption("data",f);c.sendRequest();},_submitFormData:function(){var e=$("#selectBlocktype"),b=e.val(),d=$("#height"),a=d.val();var f=$.extend(true,{data:{blockTypeID:b,additionalData:{height:a},templateID:$('input[name="id"]').val()}},{});f=this._readBlockOptionsFormData(f);e.val("0");d.val("0");var c=$.extend(true,{actionName:"createAJAX",className:this._className,parameters:f},{});this._proxy.setOption("data",c);this._proxy.sendRequest();},_submitFormDataEdit:function(){var b=this._editedBlockID;var d=$.extend(true,{data:{additionalData:{}}},{});d=this._readBlockOptionsFormData(d);var c=$.extend(true,{actionName:"editAJAX",className:this._className,parameters:d,objectIDs:[b]},{});var a=new WCF.Action.Proxy({success:$.proxy(this._successEdit,this)});a.setOption("data",c);a.sendRequest();},_readBlockOptionsFormData:function(e){for(var d=0;d<this._optionList.length;d++){var b=this._optionList[d];var c=b.replace(/_\d+/,"");var h=$('input[name="'+c+'"]');var g=false;if(h.length==0){h=$('textarea[name="'+c+'"]');}if(h.length==0){h=$('select[name="'+c+'"]');g=true;}if(h.length==1){var f=$("#"+b).val();if(f==null&&g){f=[];}e.data["additionalData"][c]=f;}else{if(h.length==0){var a={};$('input[name^="'+b+'_i18n"]').each($.proxy(function(j,l){var k=$(l);var i=k.attr("name").substring(b.length+6);i=i.substr(0,i.length-1);a[i]=k.val();},this));e.data["additionalData"][c+"_i18n"]=a;}}}return e;},_successFormData:function(f,h,c){try{var b=f.returnValues,a=$("#blockForm");this._createOptionsDialog(b);a.find('input[type="checkbox"]').change(function(j){var e=$(j.currentTarget);var i=e.prop("checked");if(i){e.val("1");}else{e.val("0");}});a.find("form").submit($.proxy(this._submitFormData,this));}catch(g){var d=true;if(d!==false){$('<div class="ajaxDebugMessage"><p>'+g.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_successFormDataEdit:function(f,h,c){try{var b=f.returnValues,a=$("#blockForm");this._createOptionsDialog(b);a.find('input[type="checkbox"]').change(function(j){var e=$(j.currentTarget);var i=e.prop("checked");if(i){e.val("1");}else{e.val("0");}});a.find("form").submit($.proxy(this._submitFormDataEdit,this));}catch(g){var d=true;if(d!==false){$('<div class="ajaxDebugMessage"><p>'+g.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_createOptionsDialog:function(b){this._optionList=b[0];var a=$("#blockForm");a.html(b[1]);a.find("form").submit($.proxy(this._stopFormSubmit,this));if(!$.wcfIsset("blockForm")){return;}this._dialog=$("#"+$.wcfEscapeID("blockForm"));this._dialog.wcfDialog({title:WCF.Language.get("wcf.acp.ultimate.template.dialog.additionalOptions")});this._dialog.removeClass("ultimateHidden");this._dialog.wcfDialog("open");WCF.TabMenu.reload();this._dialog.find("nav.tabMenu li").each(function(c,d){$(this).removeClass("active");});this._dialog.find("div.tabMenuContent").each(function(d,c){$(this).hide();});this._dialog.find("nav.tabMenu li").click($.proxy(this._toggleTabs,this));this._renderTab(this._dialog.find("nav.tabMenu li:first").data("menuItem"));this._dialog.wcfDialog("render");this._dialog.css({"max-height":"400px",overflow:"scroll"});},_toggleTabs:function(b){var a=$(b.currentTarget);if(a.hasClass("active")){return;}this._renderTab(a.data("menuItem"));},_renderTab:function(a){this._dialog.find("nav.tabMenu li").each(function(b,c){$(this).removeClass("active");});this._dialog.find("div.tabMenuContent").each(function(c,b){$(this).hide();});this._dialog.find('li[data-menu-item="'+a+'"]').addClass("active");this._dialog.find('div[data-parent-menu-item="'+a+'"]').show();},_success:function(f,i,c){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{var b=f.returnValues;var a='<li class="jsBlock sortableNode sortableNoNesting" data-object-name="'+b.blockTypeName+'" data-object-id="'+b.blockID+'">';a+='<span class="sortableNodeLabel"><span class="statusDisplay sortableButtonContainer">';if(ULTIMATE.Permission.get("admin.content.ultimate.canManageBlocks")){a+='<span title="'+WCF.Language.get("wcf.acp.ultimate.block.edit")+'" class="icon icon16 icon-pencil jsTooltip pointer" data-object-id="'+b.blockID+'"></span>';a+='\n<span title="'+WCF.Language.get("wcf.global.button.delete")+'" class="icon icon16 icon-remove jsDeleteButton jsTooltip pointer" data-object-id="'+b.blockID+'" data-confirm-message="'+WCF.Language.get("wcf.acp.ultimate.block.delete.sure")+'"></span>';}else{a+='<span title="'+WCF.Language.get("wcf.acp.ultimate.block.edit")+'" class="icon icon16 icon-pencil disabled"></span>';a+='\n<span title="'+WCF.Language.get("wcf.global.button.delete")+'" class="icon icon16 icon-remove disabled"></span>';}a+='</span>\n<span class="title">'+b.blockTypeName+" #"+b.blockID+"</span></span></li>";var h=$("#"+this._containerID);h.find("> ol").append(a);if(h.find('button[data-type="submit"]').prop("disabled")){h.find('button[data-type="submit"]').prop("disabled",false).removeClass("disabled");}if(ULTIMATE.Permission.get("admin.content.ultimate.canManageBlocks")){new WCF.Action.Delete("ultimate\\data\\block\\BlockAction",$(".jsBlock"));}this._init();this._dialog.wcfDialog("close");this._notification.show();}catch(g){var d=true;if(d!==false){$('<div class="ajaxDebugMessage"><p>'+g.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_successEdit:function(c,f,a){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{this._dialog.wcfDialog("close");this._notification.show();}catch(d){var b=true;if(b!==false){$('<div class="ajaxDebugMessage"><p>'+d.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}}};ULTIMATE.ACP.Menu={};ULTIMATE.ACP.Menu.Item={};ULTIMATE.ACP.Menu.Item.Transfer=function(a,d,c,e,b){this.init(a,d,c,e,b);};ULTIMATE.ACP.Menu.Item.Transfer.prototype={_element:null,_menuItemListID:"",_className:"",_notification:null,_offset:0,_proxy:null,_structure:{},_type:"",_submitDone:false,_sendRequest:false,init:function(a,d,c,e,b){this._element=$("#"+$.wcfEscapeID(a));this._menuItemListID=$.wcfEscapeID(d);this._className=c;this._offset=(e)?e:0;this._type=b;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._structure={};$("#"+this._menuItemListID).find('button[data-type="submit"]').click(function(f){f.preventDefault();});this._element.parent("form").submit($.proxy(this._stopFormSubmit,this));if(this._type!="custom"){this._element.find("input:checkbox").change($.proxy(this._change,this));this._element.find('button[data-type="submit"]').click($.proxy(this._submit,this));}this._init();},_init:function(){$(".sortableNode").on("remove",$.proxy(this._remove,this));},_remove:function(d){var a=$(d.target);var c=a.data("objectName");this._element.find("input:disabled").each($.proxy(function(f,h){var e=$(h);var g=e.data("name");if(c==g){e.prop("disabled",false).removeClass("disabled");}},this));var b=$("#"+this._menuItemListID);if(b.find(".sortableNode").length<=1){b.find('button[data-type="submit"]').prop("disabled",true).addClass("disabled");}},_change:function(){var a=this._element.find("input:checked").length;if(a){this._element.find('button[data-type="submit"]').removeClass("disabled").prop("disabled",false);}else{this._element.find('button[data-type="submit"]').addClass("disabled").prop("disabled",true);}},_stopFormSubmit:function(a){a.preventDefault();if(this._type!="custom"){return;}if(this._element.find('input[name="title"]').length==0){this._submit();}else{if(this._element.find('input[name="title"]').length==1){this._submit();}}},_submit:function(){this._structure={};if(this._type=="custom"){var k=$("#url"),c=$("#controller"),j=$('input[name="linkType"]'),a=j.val(),b=k.val(),h=c.val(),e=this._element.find('input[name="title"]'),m="",f={},l=$("#title");if(e.length==1){m=l.val();f=$.extend(true,{title:m},f);}else{if(e.length==0){var d={};var g=this._element.parent();g.find('input[name^="title_i18n"]').each($.proxy(function(o,q){var p=$(q);var n=p.attr("name").mb_substring(11);n=n.mb_substr(0,n.length-1);d[n]=p.val();},this));f=$.extend(true,{title_i18n:d},f);}}this._structure.url=b;this._structure.controller=h;this._structure.linkType=a;this._structure.linkTitle=m;k.val("http://");c.val("");j.val("controller");l.val("");var i=$.extend(true,{data:{offset:this._offset,structure:this._structure,type:this._type,menuID:$('input[name="id"]').val()}},{});f=$.extend(true,{actionName:"createAJAX",className:this._className,parameters:i},f);this._proxy.setOption("data",f);this._sendRequest=true;}else{this._element.find('dl > dd > ul > li > label > input[type="checkbox"]').each($.proxy(function(n,p){var o=$(p);var q=o.val();var r=o.parent().parent();if(q!==undefined){var s=o.prop("checked");this._getNestedElements(r,q);if(!this._structure[0]){this._structure[0]=[];}if(s){this._structure[0].push(q);this._sendRequest=true;o.prop("checked",false).prop("disabled",true).addClass("disabled");}}},this));i=$.extend(true,{data:{offset:this._offset,structure:this._structure,type:this._type,menuID:$('input[name="id"]').val()}},{});this._proxy.setOption("data",{actionName:"createAJAX",className:this._className,parameters:i});}if(this._element.find("input:not(:disabled)").length==0){this._change();}if(this._sendRequest){this._proxy.sendRequest();this._submitDone=true;}else{this._notification=new WCF.System.Notification(WCF.Language.get("wcf.acp.ultimate.menu.noItemsSelected"));this._notification.show();}},_getNestedElements:function(b,a){b.find('ul > li > label > input[type="checkbox"]').each($.proxy(function(d,g){var f=$(g).val();var c=$(g).prop("checked");var e=$(g).parent().parent();this._getNestedElements(e,f);if(!this._structure[a]){this._structure[a]=[];}if(c){this._structure[a].push(f);this._sendRequest=true;$(g).prop("checked",false).prop("disabled",true).addClass("disabled");}},this));},_success:function(g,d,i){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{var g=g.returnValues;for(var a in g){var f='<li id="'+WCF.getRandomID()+'" class="';f+='sortableNode"';f+=' data-object-id="'+a+'"  data-object-name="'+g[a]["menuItemNameRaw"]+'">';f+='<span class="sortableNodeLabel"><span>'+g[a]["menuItemName"]+'</span><span class="statusDisplay sortableButtonContainer">';if(g[a]["canDisable"]){f+='<span class="icon icon16 icon-check'+(g[a]["isDisabled"]?"-empty":"")+' jsToggleButton jsTooltip pointer" title="'+(g[a]["isDisabled"]?WCF.Language.get("wcf.global.button.enable"):WCF.Language.get("wcf.global.button.disable"))+'" data-object-id="'+a+'" data-disable-message="'+WCF.Language.get("wcf.global.button.disable")+'" data-enable-message="'+WCF.Language.get("wcf.global.button.enable")+'"></span>';}else{f+='<span class="icon icon16 icon-check'+(g[a]["isDisabled"]?"-empty":"")+' disabled" title="'+(g[a]["isDisabled"]?WCF.Language.get("wcf.global.button.enable"):WCF.Language.get("wcf.global.button.disable"))+'"></span>';}if(g[a]["canDelete"]){f+='&nbsp;<span class="icon icon16 icon-remove jsDeleteButton jsTooltip pointer" title="'+WCF.Language.get("wcf.global.button.delete")+'" data-object-id="'+a+'" data-confirm-message="'+g[a]["confirmMessage"]+'"></span>';}else{f+='&nbsp;<span class="icon icon16 icon-remove disabled" title="'+WCF.Language.get("wcf.global.button.delete")+'"></span>';}f+='</span></span><ol class="sortableList" data-object-id="'+a+'"></ol></li>';var b=$(f);$("#"+this._menuItemListID+"> .sortableList").append(f);var c=$("#"+this._menuItemListID);if(c.find('button[data-type="submit"]').prop("disabled")){c.find('button[data-type="submit"]').prop("disabled",false).removeClass("disabled");}}this._init();this._notification.show();}catch(h){var j=true;if(j!==false){$('<div class="ajaxDebugMessage"><p>'+h.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}}};