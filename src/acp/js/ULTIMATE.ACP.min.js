ULTIMATE.ACP={};ULTIMATE.ACP.Button={};ULTIMATE.ACP.Button.Replacement=function(b,a,c){this.init(b,a,c);};ULTIMATE.ACP.Button.Replacement.prototype={_button:null,_buttonValue:"",_checkElement:null,_initialValueDateTime:null,_lastValueDateTime:null,_initialStatusID:0,_action:"",_saveMap:{0:"ultimate.button.saveAsDraft",1:"ultimate.button.saveAsPending"},_publishMap:{0:"ultimate.button.publish",1:"ultimate.button.schedule",2:"ultimate.button.update"},init:function(b,a,c){this._button=$("#"+$.wcfEscapeID(b));this._buttonValue=this._button.val();this._checkElement=$("#"+$.wcfEscapeID(a));this._action=c;if(this._action=="save"){this._initialStatusID=this._checkElement.val();}else{if(this._action=="publish"){var d=this._checkElement.datetimepicker("getDate");this._initialValueDateTime=d;this._lastValueDateTime=d;}}this._checkElement.change($.proxy(this._change,this));this._change();},_change:function(){if(this._action=="save"){var e=this._checkElement.val();var d=WCF.Language.get(this._saveMap[e]);if(e>=2){this._button.attr("disabled","disabled").prop("disabled",true);this._button.addClass("ultimateHidden");}else{if(e==0||e==1){this._button.removeClass("ultimateHidden");this._button.removeAttr("disabled").prop("disabled",false);this._button.val(d);}}}else{if(this._action=="publish"){var f=this._checkElement.datetimepicker("getDate");var c=new Date();var b=WCF.Language.get(this._publishMap[2]);var a=(b==this._buttonValue);if(f>c){if(a&&(this._lastValueDateTime>c)){return;}if(a&&this._initialValueDateTime>c){this._button.val(b);}else{this._button.val(WCF.Language.get(this._publishMap[1]));}}else{if(a&&(this._lastValueDateTime<c)){return;}if(a&&this._initialValueDateTime<c){this._button.val(b);}else{this._button.val(WCF.Language.get(this._publishMap[0]));}}this._lastValueDateTime=f;}}}};ULTIMATE.ACP.Block={};ULTIMATE.ACP.Block.Transfer=function(b,a,c){this.init(b,a,c);};ULTIMATE.ACP.Block.Transfer.prototype={_element:null,_container:null,_containerID:"",_notification:null,_proxy:null,_optionList:[],_dialog:null,_editBlockID:0,init:function(b,a,c){this._element=$("#"+$.wcfEscapeID(b));this._container=$("#"+$.wcfEscapeID(a));this._containerID=$.wcfEscapeID(a);this._className=c;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$("#"+this._containerID).find('button[data-type="submit"]').click(function(d){d.preventDefault();});this._element.parent("form").submit($.proxy(this._stopFormSubmit,this));this._element.find('button[data-type="submit"]').click($.proxy(this._submit,this));this._init();},_init:function(){$(".jsBlock").on("remove",$.proxy(this._remove,this));$(".icon-pencil").not(".disabled").on("click",$.proxy(this._edit,this));},_stopFormSubmit:function(a){a.preventDefault();},_remove:function(a){if($("#"+this._containerID).find(".jsBlock").length<=1){$("#"+this._containerID).find('button[data-type="submit"]').prop("disabled",true).addClass("disabled");}},_edit:function(g){var a=$(g.currentTarget);g.preventDefault();var d={};var c=a.data("objectID");this._editedBlockID=c;var f=$.extend(true,{data:{blockID:c}},{});var e=$.extend(true,{actionName:"getFormDataEditAJAX",className:this._className,parameters:f},d);var b=new WCF.Action.Proxy({success:$.proxy(this._successFormDataEdit,this)});b.setOption("data",e);b.sendRequest();},_submit:function(){var d={};var c=$("#selectBlocktype").val();if(c=="0"){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.form.error"),"error");this._element.find("dl:first").addClass("formError");var a='<small id="selectBlocktypeError" class="innerError">'+WCF.Language.get("wcf.acp.ultimate.template.selectBlocktype.error.notSelected")+"</small>";$("#selectBlocktypeError").empty().remove();this._element.find("dl:first > dd").append(a);this._notification.show();return;}this._notification=null;$("#selectBlocktypeError").empty().remove();var f=$.extend(true,{data:{blockTypeID:c}},{});var e=$.extend(true,{actionName:"getFormDataAJAX",className:this._className,parameters:f},d);var b=new WCF.Action.Proxy({success:$.proxy(this._successFormData,this)});b.setOption("data",e);b.sendRequest();},_submitFormData:function(){var b=$("#selectBlocktype").val();var a=$("#height").val();var d=$.extend(true,{data:{blockTypeID:b,additionalData:{height:a},templateID:$('input[name="id"]').val()}},{});d=this._readBlockOptionsFormData(d);$("#selectBlocktype").val("0");$("#height").val("0");var c=$.extend(true,{actionName:"createAJAX",className:this._className,parameters:d},{});this._proxy.setOption("data",c);this._proxy.sendRequest();},_submitFormDataEdit:function(){var b=this._editedBlockID;var d=$.extend(true,{data:{additionalData:{}}},{});d=this._readBlockOptionsFormData(d);var c=$.extend(true,{actionName:"editAJAX",className:this._className,parameters:d,objectIDs:[b]},{});var a=new WCF.Action.Proxy({success:$.proxy(this._successEdit,this)});a.setOption("data",c);a.sendRequest();},_readBlockOptionsFormData:function(e){for(var d=0;d<this._optionList.length;d++){var b=this._optionList[d];var c=b.replace(/_\d+/,"");var h=$('input[name="'+c+'"]');var g=false;if(h.length==0){h=$('textarea[name="'+c+'"]');}if(h.length==0){h=$('select[name="'+c+'"]');g=true;}if(h.length==1){var f=$("#"+b).val();if(f==null&&g){f=[];}e.data["additionalData"][c]=f;}else{if(h.length==0){var a={};$('input[name^="'+b+'_i18n"]').each($.proxy(function(j,l){var k=$(l);var i=k.attr("name").substring(b.length+6);i=i.substr(0,i.length-1);a[i]=k.val();},this));e.data["additionalData"][c+"_i18n"]=a;}}}return e;},_successFormData:function(d,g,b){try{var a=d.returnValues;this._createOptionsDialog(a);$("#blockForm").find('input[type="checkbox"]').change(function(i){var e=$(i.currentTarget);var h=e.prop("checked");if(h){e.val("1");}else{e.val("0");}});$("#blockForm").find("form").submit($.proxy(this._submitFormData,this));}catch(f){var c=true;if(c!==false){$('<div class="ajaxDebugMessage"><p>'+f.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_successFormDataEdit:function(d,g,b){try{var a=d.returnValues;this._createOptionsDialog(a);$("#blockForm").find('input[type="checkbox"]').change(function(i){var e=$(i.currentTarget);var h=e.prop("checked");if(h){e.val("1");}else{e.val("0");}});$("#blockForm").find("form").submit($.proxy(this._submitFormDataEdit,this));}catch(f){var c=true;if(c!==false){$('<div class="ajaxDebugMessage"><p>'+f.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_createOptionsDialog:function(a){this._optionList=a[0];$("#blockForm").html(a[1]);$("#blockForm").find("form").submit($.proxy(this._stopFormSubmit,this));if(!$.wcfIsset("blockForm")){return;}this._dialog=$("#"+$.wcfEscapeID("blockForm"));this._dialog.wcfDialog({title:WCF.Language.get("wcf.acp.ultimate.template.dialog.additionalOptions")});this._dialog.removeClass("ultimateHidden");this._dialog.wcfDialog("open");WCF.TabMenu.reload();this._dialog.find("nav.tabMenu li").each(function(b,c){$(this).removeClass("active");});this._dialog.find("div.tabMenuContent").each(function(c,b){$(this).hide();});this._dialog.find("nav.tabMenu li").click($.proxy(this._toggleTabs,this));this._renderTab(this._dialog.find("nav.tabMenu li:first").data("menuItem"));this._dialog.wcfDialog("render");this._dialog.css({"max-height":"400px",overflow:"scroll"});},_toggleTabs:function(b){var a=$(b.currentTarget);if(a.hasClass("active")){return;}this._renderTab(a.data("menuItem"));},_renderTab:function(a){this._dialog.find("nav.tabMenu li").each(function(b,c){$(this).removeClass("active");});this._dialog.find("div.tabMenuContent").each(function(c,b){$(this).hide();});this._dialog.find('li[data-menu-item="'+a+'"]').addClass("active");this._dialog.find('div[data-parent-menu-item="'+a+'"]').show();},_success:function(f,h,c){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{var b=f.returnValues;var a='<li class="jsBlock sortableNode sortableNoNesting" data-object-name="'+b.blockTypeName+'" data-object-id="'+b.blockID+'">';a+='<span class="sortableNodeLabel"><span class="statusDisplay sortableButtonContainer">';if(ULTIMATE.Permission.get("admin.content.ultimate.canManageBlocks")){a+='<span title="'+WCF.Language.get("wcf.acp.ultimate.block.edit")+'" class="icon icon16 icon-pencil jsTooltip pointer" data-object-id="'+b.blockID+'"></span>';a+='\n<span title="'+WCF.Language.get("wcf.global.button.delete")+'" class="icon icon16 icon-remove jsDeleteButton jsTooltip pointer" data-object-id="'+b.blockID+'" data-confirm-message="'+WCF.Language.get("wcf.acp.ultimate.block.delete.sure")+'"></span>';}else{a+='<span title="'+WCF.Language.get("wcf.acp.ultimate.block.edit")+'" class="icon icon16 icon-pencil disabled"></span>';a+='\n<span title="'+WCF.Language.get("wcf.global.button.delete")+'" class="icon icon16 icon-remove disabled"></span>';}a+='</span>\n<span class="title">'+b.blockTypeName+" #"+b.blockID+"</span></span></li>";$("#"+this._containerID).find("> ol").append(a);if($("#"+this._containerID).find('button[data-type="submit"]').prop("disabled")){$("#"+this._containerID).find('button[data-type="submit"]').prop("disabled",false).removeClass("disabled");}if(ULTIMATE.Permission.get("admin.content.ultimate.canManageBlocks")){new WCF.Action.Delete("ultimate\\data\\block\\BlockAction",$(".jsBlock"));}this._init();this._dialog.wcfDialog("close");this._notification.show();}catch(g){var d=true;if(d!==false){$('<div class="ajaxDebugMessage"><p>'+g.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_successEdit:function(c,f,a){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{this._dialog.wcfDialog("close");this._notification.show();}catch(d){var b=true;if(b!==false){$('<div class="ajaxDebugMessage"><p>'+d.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}}};ULTIMATE.ACP.Menu={};ULTIMATE.ACP.Menu.Item={};ULTIMATE.ACP.Menu.Item.Transfer=function(a,d,c,e,b){this.init(a,d,c,e,b);};ULTIMATE.ACP.Menu.Item.Transfer.prototype={_element:null,_menuItemListID:"",_className:"",_notification:null,_offset:0,_proxy:null,_structure:{},_type:"",_submitDone:false,_sendRequest:false,init:function(a,d,c,e,b){this._element=$("#"+$.wcfEscapeID(a));this._menuItemListID=$.wcfEscapeID(d);this._className=c;this._offset=(e)?e:0;this._type=b;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._structure={};$("#"+this._menuItemListID).find('button[data-type="submit"]').click(function(f){f.preventDefault();});this._element.parent("form").submit($.proxy(this._stopFormSubmit,this));if(this._type!="custom"){this._element.find("input:checkbox").change($.proxy(this._change,this));this._element.find('button[data-type="submit"]').click($.proxy(this._submit,this));}this._init();},_init:function(){$(".sortableNode").on("remove",$.proxy(this._remove,this));},_remove:function(c){var a=$(c.target);var b=a.data("objectName");this._element.find("input:disabled").each($.proxy(function(e,g){var d=$(g);var f=d.data("name");if(b==f){d.prop("disabled",false).removeClass("disabled");}},this));if($("#"+this._menuItemListID).find(".sortableNode").length<=1){$("#"+this._menuItemListID).find('button[data-type="submit"]').prop("disabled",true).addClass("disabled");}},_change:function(){var a=this._element.find("input:checked").length;if(a){this._element.find('button[data-type="submit"]').removeClass("disabled").prop("disabled",false);}else{this._element.find('button[data-type="submit"]').addClass("disabled").prop("disabled",true);}},_stopFormSubmit:function(a){a.preventDefault();if(this._type!="custom"){return;}if(this._element.find('input[name="title"]').length==0){this._submit();}else{if(this._element.find('input[name="title"]').length==1){this._submit();}}},_submit:function(){this._structure={};if(this._type=="custom"){var a=$('input[name="linkType"]').val();var b=$("#url").val();var g=$("#controller").val();var d=this._element.find('input[name="title"]');var i="";var e={};if(d.length==1){i=$("#title").val();e=$.extend(true,{title:i},e);}else{if(d.length==0){var c={};var f=this._element.parent();f.find('input[name^="title_i18n"]').each($.proxy(function(k,m){var l=$(m);var j=l.attr("name").mb_substring(11);j=j.mb_substr(0,j.length-1);c[j]=l.val();},this));e=$.extend(true,{title_i18n:c},e);}}this._structure.url=b;this._structure.controller=g;this._structure.linkType=a;this._structure.linkTitle=i;$("#url").val("http://");$("#controller").val("");$('input[name="linkType"]').val("controller");$("#title").val("");var h=$.extend(true,{data:{offset:this._offset,structure:this._structure,type:this._type,menuID:$('input[name="id"]').val()}},{});e=$.extend(true,{actionName:"createAJAX",className:this._className,parameters:h},e);this._proxy.setOption("data",e);this._sendRequest=true;}else{this._element.find('dl > dd > ul > li > label > input[type="checkbox"]').each($.proxy(function(j,l){var k=$(l);var m=k.val();var n=k.parent().parent();if(m!==undefined){$checkedParent=k.prop("checked");this._getNestedElements(n,m);if(!this._structure[0]){this._structure[0]=[];}if($checkedParent){this._structure[0].push(m);this._sendRequest=true;k.prop("checked",false).prop("disabled",true).addClass("disabled");}}},this));var h=$.extend(true,{data:{offset:this._offset,structure:this._structure,type:this._type,menuID:$('input[name="id"]').val()}},{});this._proxy.setOption("data",{actionName:"createAJAX",className:this._className,parameters:h});}if(this._element.find("input:not(:disabled)").length==0){this._change();}if(this._sendRequest){this._proxy.sendRequest();this._submitDone=true;}else{this._notification=new WCF.System.Notification(WCF.Language.get("wcf.acp.ultimate.menu.noItemsSelected"));this._notification.show();}},_getNestedElements:function(b,a){b.find('ul > li > label > input[type="checkbox"]').each($.proxy(function(d,g){var f=$(g).val();var c=$(g).prop("checked");var e=$(g).parent().parent();this._getNestedElements(e,f);if(!this._structure[a]){this._structure[a]=[];}if(c){this._structure[a].push(f);this._sendRequest=true;$(g).prop("checked",false).prop("disabled",true).addClass("disabled");}},this));},_success:function(f,i,b){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{var f=f.returnValues;for(var a in f){var h='<li id="'+WCF.getRandomID()+'" class="';h+='sortableNode"';h+=' data-object-id="'+a+'"  data-object-name="'+f[a]["menuItemNameRaw"]+'">';h+='<span class="sortableNodeLabel"><span>'+f[a]["menuItemName"]+'</span><span class="statusDisplay sortableButtonContainer">';if(f[a]["canDisable"]){h+='<span class="icon icon16 icon-check'+(f[a]["isDisabled"]?"-empty":"")+' jsToggleButton jsTooltip pointer" title="'+(f[a]["isDisabled"]?WCF.Language.get("wcf.global.button.enable"):WCF.Language.get("wcf.global.button.disable"))+'" data-object-id="'+a+'" data-disable-message="'+WCF.Language.get("wcf.global.button.disable")+'" data-enable-message="'+WCF.Language.get("wcf.global.button.enable")+'"></span>';}else{h+='<span class="icon icon16 icon-check'+(f[a]["isDisabled"]?"-empty":"")+' disabled" title="'+(f[a]["isDisabled"]?WCF.Language.get("wcf.global.button.enable"):WCF.Language.get("wcf.global.button.disable"))+'"></span>';}if(f[a]["canDelete"]){h+='&nbsp;<span class="icon icon16 icon-remove jsDeleteButton jsTooltip pointer" title="'+WCF.Language.get("wcf.global.button.delete")+'" data-object-id="'+a+'" data-confirm-message="'+f[a]["confirmMessage"]+'"></span>';}else{h+='&nbsp;<span class="icon icon16 icon-remove disabled" title="'+WCF.Language.get("wcf.global.button.delete")+'"></span>';}h+='</span></span><ol class="sortableList" data-object-id="'+a+'"></ol></li>';var d=$(h);$("#"+this._menuItemListID+"> .sortableList").append(h);if($("#"+this._menuItemListID).find('button[data-type="submit"]').prop("disabled")){$("#"+this._menuItemListID).find('button[data-type="submit"]').prop("disabled",false).removeClass("disabled");}}this._init();this._notification.show();}catch(g){var c=true;if(c!==false){$('<div class="ajaxDebugMessage"><p>'+g.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}}};