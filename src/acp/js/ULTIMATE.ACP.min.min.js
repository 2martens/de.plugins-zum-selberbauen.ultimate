ULTIMATE.ACP={};ULTIMATE.ACP.Button={};ULTIMATE.ACP.Button.Replacement=function(d,e,f){this.init(d,e,f);};ULTIMATE.ACP.Button.Replacement.prototype={_button:null,_buttonValue:"",_checkElement:null,_initialValueDateTime:null,_lastValueDateTime:null,_initialStatusID:0,_action:"",_saveMap:{0:"ultimate.button.saveAsDraft",1:"ultimate.button.saveAsPending"},_publishMap:{0:"ultimate.button.publish",1:"ultimate.button.schedule",2:"ultimate.button.update"},init:function(e,f,h){this._button=$("#"+$.wcfEscapeID(e));this._buttonValue=this._button.val();this._checkElement=$("#"+$.wcfEscapeID(f));this._action=h;if(this._action=="save"){this._initialStatusID=this._checkElement.val();}else{if(this._action=="publish"){var g=this._checkElement.datetimepicker("getDate");this._initialValueDateTime=g;this._lastValueDateTime=g;}}this._checkElement.change($.proxy(this._change,this));this._change();},_change:function(){if(this._action=="save"){var j=this._checkElement.val();var k=WCF.Language.get(this._saveMap[j]);if(j>=2){this._button.attr("disabled","disabled").prop("disabled",true);this._button.addClass("ultimateHidden");}else{if(j==0||j==1){this._button.removeClass("ultimateHidden");this._button.removeAttr("disabled").prop("disabled",false);this._button.val(k);}}}else{if(this._action=="publish"){var i=this._checkElement.datetimepicker("getDate");var l=new Date();var g=WCF.Language.get(this._publishMap[2]);var h=(g==this._buttonValue);if(i>l){if(h&&(this._lastValueDateTime>l)){return;}if(h&&this._initialValueDateTime>l){this._button.val(g);}else{this._button.val(WCF.Language.get(this._publishMap[1]));}}else{if(h&&(this._lastValueDateTime<l)){return;}if(h&&this._initialValueDateTime<l){this._button.val(g);}else{this._button.val(WCF.Language.get(this._publishMap[0]));}}this._lastValueDateTime=i;}}}};ULTIMATE.ACP.Block={};ULTIMATE.ACP.Block.Transfer=function(d,e,f){this.init(d,e,f);};ULTIMATE.ACP.Block.Transfer.prototype={_element:null,_container:null,_containerID:"",_notification:null,_proxy:null,_optionList:[],_dialog:null,_editBlockID:0,init:function(d,e,f){this._element=$("#"+$.wcfEscapeID(d));this._container=$("#"+$.wcfEscapeID(e));this._containerID=$.wcfEscapeID(e);this._className=f;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});$("#"+this._containerID).find('button[data-type="submit"]').click(function(a){a.preventDefault();});this._element.parent("form").submit($.proxy(this._stopFormSubmit,this));this._element.find('button[data-type="submit"]').click($.proxy(this._submit,this));this._init();},_init:function(){$(".jsBlock").on("remove",$.proxy(this._remove,this));$(".icon-pencil").not(".disabled").on("click",$.proxy(this._edit,this));},_stopFormSubmit:function(b){b.preventDefault();return;},_remove:function(b){if($("#"+this._containerID).find(".jsBlock").length<=1){$("#"+this._containerID).find('button[data-type="submit"]').prop("disabled",true).addClass("disabled");}},_edit:function(j){var i=$(j.currentTarget);j.preventDefault();var m={};var n=i.data("objectID");this._editedBlockID=n;var k=$.extend(true,{data:{blockID:n}},{});var l=$.extend(true,{actionName:"getFormDataEditAJAX",className:this._className,parameters:k},m);var h=new WCF.Action.Proxy({success:$.proxy(this._successFormDataEdit,this)});h.setOption("data",l);h.sendRequest();},_submit:function(){var k={};var l=$("#selectBlocktype").val();if(l=="0"){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.form.error"),"error");this._element.find("dl:first").addClass("formError");var h='<small id="selectBlocktypeError" class="innerError">'+WCF.Language.get("wcf.acp.ultimate.template.selectBlocktype.error.notSelected")+"</small>";$("#selectBlocktypeError").empty().remove();this._element.find("dl:first > dd").append(h);this._notification.show();return;}this._notification=null;$("#selectBlocktypeError").empty().remove();var i=$.extend(true,{data:{blockTypeID:l}},{});var j=$.extend(true,{actionName:"getFormDataAJAX",className:this._className,parameters:i},k);var g=new WCF.Action.Proxy({success:$.proxy(this._successFormData,this)});g.setOption("data",j);g.sendRequest();},_submitFormData:function(){var e=$("#selectBlocktype").val();var f=$("#height").val();var g=$.extend(true,{data:{blockTypeID:e,additionalData:{height:f},templateID:$('input[name="id"]').val()}},{});g=this._readBlockOptionsFormData(g);$("#selectBlocktype").val("0");$("#height").val("0");var h=$.extend(true,{actionName:"createAJAX",className:this._className,parameters:g},{});this._proxy.setOption("data",h);this._proxy.sendRequest();},_submitFormDataEdit:function(){var e=this._editedBlockID;var g=$.extend(true,{data:{additionalData:{}}},{});g=this._readBlockOptionsFormData(g);var h=$.extend(true,{actionName:"editAJAX",className:this._className,parameters:g,objectIDs:[e]},{});var f=new WCF.Action.Proxy({success:$.proxy(this._successEdit,this)});f.setOption("data",h);f.sendRequest();},_readBlockOptionsFormData:function(n){for(var o=0;o<this._optionList.length;o++){var i=this._optionList[o];var p=i.replace(/_\d+/,"");var k=$('input[name="'+p+'"]');var l=false;if(k.length==0){k=$('textarea[name="'+p+'"]');}if(k.length==0){k=$('select[name="'+p+'"]');l=true;}if(k.length==1){var m=$("#"+i).val();if(m==null&&l){m=[];}n.data.additionalData[p]=m;}else{if(k.length==0){var j={};$('input[name^="'+i+'_i18n"]').each($.proxy(function(c,a){var b=$(a);var d=b.attr("name").mb_substring(i.length+6);d=d.mb_substr(0,d.length-1);j[d]=b.val();},this));n.data.additionalData[p+"_i18n"]=j;}}}return n;},_successFormData:function(k,i,e){try{var h=k.returnValues;this._createOptionsDialog(h);$('#blockForm input[type="checkbox"]').change(function(a){var c=$(a.currentTarget);var b=c.prop("checked");if(b){c.val("1");}else{c.val("0");}});$("#blockForm").find("form").submit($.proxy(this._submitFormData,this));}catch(j){var l=true;if(l!==false){$('<div class="ajaxDebugMessage"><p>'+j.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_successFormDataEdit:function(k,i,e){try{var h=k.returnValues;this._createOptionsDialog(h);$('#blockForm input[type="checkbox"]').change(function(a){var c=$(a.currentTarget);var b=c.prop("checked");if(b){c.val("1");}else{c.val("0");}});$("#blockForm").find("form").submit($.proxy(this._submitFormDataEdit,this));}catch(j){var l=true;if(l!==false){$('<div class="ajaxDebugMessage"><p>'+j.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_createOptionsDialog:function(b){this._optionList=b[0];$("#blockForm").html(b[1]);$("#blockForm").find("form").submit($.proxy(this._stopFormSubmit,this));if(!$.wcfIsset("blockForm")){return;}this._dialog=$("#"+$.wcfEscapeID("blockForm"));this._dialog.wcfDialog({title:WCF.Language.get("wcf.acp.ultimate.template.dialog.additionalOptions")});this._dialog.removeClass("ultimateHidden");this._dialog.wcfDialog("open");WCF.TabMenu.reload();this._dialog.find("nav.tabMenu li").each(function(a,d){$(this).removeClass("active");});this._dialog.find("div.tabMenuContent").each(function(d,a){$(this).hide();});this._dialog.find("nav.tabMenu li").click($.proxy(this._toggleTabs,this));this._renderTab(this._dialog.find("nav.tabMenu li:first").data("menuItem"));this._dialog.wcfDialog("render");this._dialog.css({"max-height":"400px",overflow:"scroll"});},_toggleTabs:function(c){var d=$(c.currentTarget);if(d.hasClass("active")){return;}this._renderTab(d.data("menuItem"));},_renderTab:function(b){this._dialog.find("nav.tabMenu li").each(function(a,d){$(this).removeClass("active");});this._dialog.find("div.tabMenuContent").each(function(d,a){$(this).hide();});this._dialog.find('li[data-menu-item="'+b+'"]').addClass("active");this._dialog.find('div[data-parent-menu-item="'+b+'"]').show();},_success:function(l,j,n){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{var e=l.returnValues;var i='<li class="jsBlock sortableNode sortableNoNesting" data-object-name="'+e.blockTypeName+'" data-object-id="'+e.blockID+'">';i+='<span class="sortableNodeLabel"><span class="statusDisplay sortableButtonContainer">';if(ULTIMATE.Permission.get("admin.content.ultimate.canManageBlocks")){i+='<span title="'+WCF.Language.get("wcf.acp.ultimate.block.edit")+'" class="icon icon16 icon-pencil jsTooltip" data-object-id="'+e.blockID+'"></span>';i+='\n<span title="'+WCF.Language.get("wcf.global.button.delete")+'" class="icon icon16 icon-remove jsDeleteButton jsTooltip" data-object-id="'+e.blockID+'" data-confirm-message="'+WCF.Language.get("wcf.acp.ultimate.block.delete.sure")+'"></span>';}else{i+='<span title="'+WCF.Language.get("wcf.acp.ultimate.block.edit")+'" class="icon icon16 icon-pencil disabled"></span>';i+='\n<span title="'+WCF.Language.get("wcf.global.button.delete")+'" class="icon icon16 icon-remove disabled"></span>';}i+='</span>\n<span class="title">'+e.blockTypeName+" #"+e.blockID+"</span></span></li>";$("#"+this._containerID).find("> ol").append(i);if($("#"+this._containerID).find('button[data-type="submit"]').prop("disabled")){$("#"+this._containerID).find('button[data-type="submit"]').prop("disabled",false).removeClass("disabled");}if(ULTIMATE.Permission.get("admin.content.ultimate.canManageBlocks")){new WCF.Action.Delete("ultimate\\data\\block\\BlockAction",$(".jsBlock"));}this._init();this._dialog.wcfDialog("close");this._notification.show();}catch(k){var m=true;if(m!==false){$('<div class="ajaxDebugMessage"><p>'+k.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}},_successEdit:function(j,h,g){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{this._dialog.wcfDialog("close");this._notification.show();}catch(i){var e=true;if(e!==false){$('<div class="ajaxDebugMessage"><p>'+i.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}}};ULTIMATE.ACP.Menu={};ULTIMATE.ACP.Menu.Item={};ULTIMATE.ACP.Menu.Item.Transfer=function(g,i,j,h,f){this.init(g,i,j,h,f);};ULTIMATE.ACP.Menu.Item.Transfer.prototype={_element:null,_menuItemListID:"",_className:"",_notification:null,_offset:0,_proxy:null,_structure:{},_type:"",_submitDone:false,_sendRequest:false,init:function(g,i,j,h,f){this._element=$("#"+$.wcfEscapeID(g));this._menuItemListID=$.wcfEscapeID(i);this._className=j;this._offset=(h)?h:0;this._type=f;this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});this._structure={};$("#"+this._menuItemListID).find('button[data-type="submit"]').click(function(a){a.preventDefault();});this._element.parent("form").submit($.proxy(this._stopFormSubmit,this));if(this._type!="custom"){this._element.find("input:checkbox").change($.proxy(this._change,this));this._element.find('button[data-type="submit"]').click($.proxy(this._submit,this));}this._init();},_init:function(){$(".sortableNode").on("remove",$.proxy(this._remove,this));},_remove:function(f){var e=$(f.target);var d=e.data("objectName");this._element.find("input:disabled").each($.proxy(function(c,a){var h=$(a);var b=h.data("name");if(d==b){h.prop("disabled",false).removeClass("disabled");}},this));if($("#"+this._menuItemListID).find(".sortableNode").length<=1){$("#"+this._menuItemListID).find('button[data-type="submit"]').prop("disabled",true).addClass("disabled");}},_change:function(){var b=this._element.find("input:checked").length;if(b){this._element.find('button[data-type="submit"]').removeClass("disabled").prop("disabled",false);}else{this._element.find('button[data-type="submit"]').addClass("disabled").prop("disabled",true);}},_stopFormSubmit:function(b){b.preventDefault();if(this._type!="custom"){return;}if(this._element.find('input[name="title"]').length==0){this._submit();}else{if(this._element.find('input[name="title"]').length==1){this._submit();}}},_submit:function(){this._structure={};if(this._type=="custom"){var r=$('input[name="linkType"]').val();var q=$("#url").val();var l=$("#controller").val();var o=this._element.find('input[name="title"]');var j="";var n={};if(o.length==1){j=$("#title").val();n=$.extend(true,{title:j},n);}else{if(o.length==0){var p={};var m=this._element.parent();m.find('input[name^="title_i18n"]').each($.proxy(function(c,a){var b=$(a);var d=b.attr("name").mb_substring(11);d=d.mb_substr(0,d.length-1);p[d]=b.val();},this));n=$.extend(true,{title_i18n:p},n);}}this._structure.url=q;this._structure.controller=l;this._structure.linkType=r;this._structure.linkTitle=j;$("#url").val("http://");$("#controller").val("");$('input[name="linkType"]').val("controller");$("#title").val("");var k=$.extend(true,{data:{offset:this._offset,structure:this._structure,type:this._type,menuID:$('input[name="id"]').val()}},{});n=$.extend(true,{actionName:"createAJAX",className:this._className,parameters:k},n);this._proxy.setOption("data",n);this._sendRequest=true;}else{this._element.find('dl > dd > ul > li > label > input[type="checkbox"]').each($.proxy(function(d,b){var c=$(b);var a=c.val();var e=c.parent().parent();if(a!==undefined){$checkedParent=c.prop("checked");this._getNestedElements(e,a);if(!this._structure[0]){this._structure[0]=[];}if($checkedParent){this._structure[0].push(a);this._sendRequest=true;c.prop("checked",false).prop("disabled",true).addClass("disabled");}}},this));var k=$.extend(true,{data:{offset:this._offset,structure:this._structure,type:this._type,menuID:$('input[name="id"]').val()}},{});this._proxy.setOption("data",{actionName:"createAJAX",className:this._className,parameters:k});}if(this._element.find("input:not(:disabled)").length==0){this._change();}if(this._sendRequest){this._proxy.sendRequest();this._submitDone=true;}else{this._notification=new WCF.System.Notification(WCF.Language.get("wcf.acp.ultimate.menu.noItemsSelected"));this._notification.show();}},_getNestedElements:function(c,d){c.find('ul > li > label > input[type="checkbox"]').each($.proxy(function(i,a){var b=$(a).val();var j=$(a).prop("checked");var h=$(a).parent().parent();this._getNestedElements(h,b);if(!this._structure[d]){this._structure[d]=[];}if(j){this._structure[d].push(b);this._sendRequest=true;$(a).prop("checked",false).prop("disabled",true).addClass("disabled");}},this));},_success:function(n,k,e){if(this._notification===null){this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"));}try{var n=n.returnValues;for(var j in n){var l='<li id="'+WCF.getRandomID()+'" class="';l+='sortableNode"';l+=' data-object-id="'+j+'"  data-object-name="'+n[j]["menuItemNameRaw"]+'">';l+='<span class="sortableNodeLabel"><span>'+n[j]["menuItemName"]+'</span><span class="statusDisplay sortableButtonContainer">';if(n[j]["canDisable"]){l+='<span class="icon icon16 icon-check'+(n[j]["isDisabled"]?"-empty":"")+' jsToggleButton jsTooltip pointer" title="'+(n[j]["isDisabled"]?WCF.Language.get("wcf.global.button.enable"):WCF.Language.get("wcf.global.button.disable"))+'" data-object-id="'+j+'" data-disable-message="'+WCF.Language.get("wcf.global.button.disable")+'" data-enable-message="'+WCF.Language.get("wcf.global.button.enable")+'"></span>';}else{l+='<span class="icon icon16 icon-check'+(n[j]["isDisabled"]?"-empty":"")+' disabled" title="'+(n[j]["isDisabled"]?WCF.Language.get("wcf.global.button.enable"):WCF.Language.get("wcf.global.button.disable"))+'"></span>';}if(n[j]["canDelete"]){l+='&nbsp;<span class="icon icon16 icon-remove jsDeleteButton jsTooltip pointer" title="'+WCF.Language.get("wcf.global.button.delete")+'" data-object-id="'+j+'" data-confirm-message="'+n[j]["confirmMessage"]+'"></span>';}else{l+='&nbsp;<span class="icon icon16 icon-remove disabled" title="'+WCF.Language.get("wcf.global.button.delete")+'"></span>';}l+='</span></span><ol class="sortableList" data-object-id="'+j+'"></ol></li>';var o=$(l);$("#"+this._menuItemListID+"> .sortableList").append(l);if($("#"+this._menuItemListID).find('button[data-type="submit"]').prop("disabled")){$("#"+this._menuItemListID).find('button[data-type="submit"]').prop("disabled",false).removeClass("disabled");}}this._init();this._notification.show();}catch(m){var p=true;if(p!==false){$('<div class="ajaxDebugMessage"><p>'+m.message+"</p></div>").wcfDialog({title:WCF.Language.get("wcf.global.error.title")});}}}};