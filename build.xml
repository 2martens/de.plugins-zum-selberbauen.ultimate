<?xml version="1.0" encoding="UTF-8"?>
<project name="Ultimate CMS" default="build">
	<target name="clean" description="Deletes old tar files.">
		<delete failonerror="false">
			<fileset dir="metadata" includes="**/*.tar"/>
		</delete>
		<delete failonerror="false" dir="build" />
	</target>
	
	<target name="prepare" depends="clean" description="Prepares the build.">
		<mkdir dir="build" />
	</target>
	
	<target name="pack" depends="prepare" description="Packs the tar files.">
		<tar destfile="metadata/templates.tar" 
			basedir="src/templates" 
		/>
		<tar destfile="metadata/acptemplates.tar" 
			basedir="src/acp/templates"
		/>
		<tar destfile="metadata/files.tar">
			<tarfileset dir="src">
				<exclude name="templates/**" />
				<exclude name="acp/templates/**" />
			</tarfileset>
		</tar>
		<tar destfile="metadata/files_wcf.tar" 
			basedir="srcWCF" 
		/>
		
		<!-- rc 3 update tar -->
		<tar destfile="metadata/files_update.rc3.tar">
			<tarfileset dir="src">
				<exclude name="templates/**" />
				<exclude name="acp/templates/**" />
				<include name="lib/acp/form/*" />
				<include name="lib/acp/page/UltimateContentListPage*" />
				<include name="lib/data/category/Category.class.php" />
				<include name="lib/data/content/ContentAction*" />
				<include name="lib/data/content/ContentEditor*" />
				<include name="lib/data/content/TaggableContent*" />
				<include name="lib/data/menu/item/MenuItemAction*" />
				<include name="lib/data/page/Page.class.php" />
				<include name="lib/data/page/PageAction*" />
				<include name="lib/data/template/Template.class.php" />
				<include name="lib/data/widget/area/WidgetAreaAction*" />
				<include name="lib/page/*" />
				<include name="lib/system/ULTIMATECore*" />
				<include name="lib/system/block/BlockHandler*" />
				<include name="lib/system/blocktype/Abstract*" />
				<include name="lib/system/blocktype/Content*" />
				<include name="lib/system/blocktype/IBlockType*" />
				<include name="lib/system/cache/builder/AuthorCacheBuilder*" />
				<include name="lib/system/event/listener/IndexFirstTime*" />
				<include name="lib/system/event/listener/TaggedPage*" />
				<include name="lib/system/exporter/WordPress3xExporter*" />
				<include name="lib/system/menu/custom/CustomMenu*" />
				<include name="lib/system/search/ContentSearch*" />
				<include name="lib/system/style/*" />
				<include name="lib/system/template/TemplateHandler*" />
				<include name="lib/system/user/notification/event/*" />
				<include name="lib/system/user/notification/object/type/*" />
				<include name="lib/system/widget/WidgetHandler*" />
				<include name="lib/util/WidgetAreaUtil*" />
				<include name="lib/util/thirdParty/idna_convert.class.php*" />
			</tarfileset>
		</tar>
		<tar destfile="metadata/acptemplates_update.rc3.tar">
			<tarfileset dir="src/acp/templates">
				<include name="*header.tpl" />
				<include name="*CategoryAdd.tpl" />
				<include name="*ContentAdd.tpl" />
				<include name="*PageAdd.tpl" />
			</tarfileset>
		</tar>
	</target>
	
	<target name="build" depends="pack" description="Generates the package archive.">
		<tar destfile="build/de.plugins-zum-selberbauen.ultimate.tar" 
			 basedir="metadata"
		/>
		<gzip src="build/de.plugins-zum-selberbauen.ultimate.tar"
			  destfile="build/de.plugins-zum-selberbauen.ultimate.tar.gz"
		/>
	</target>
</project>