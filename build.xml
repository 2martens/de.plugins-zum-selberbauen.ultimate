<?xml version="1.0" encoding="UTF-8"?>
<project name="Ultimate CMS" default="build">
	<target name="clean" description="Deletes old tar files.">
		<delete failonerror="false">
			<fileset dir="metadata" includes="**/*.tar"/>
		</delete>
		<delete failonerror="false" dir="build" />
	</target>
	
	<target name="prepare" depends="clean" description="Prepares the build.">
		<mkdir dir="build" />
	</target>
	
	<target name="pack" depends="prepare" description="Packs the tar files.">
		<tar destfile="metadata/templates.tar" 
			basedir="src/templates" 
		/>
		<tar destfile="metadata/acptemplates.tar" 
			basedir="src/acp/templates"
		/>
		<tar destfile="metadata/files.tar">
			<tarfileset dir="src">
				<exclude name="templates/**" />
				<exclude name="acp/templates/**" />
			</tarfileset>
		</tar>
		<tar destfile="metadata/files_wcf.tar" 
			basedir="srcWCF" 
		/>
		
		<!-- beta 3 update tars -->
		<tar destfile="metadata/templates_update.b2.tar">
			<tarfileset dir="src/templates">
				<include name="contentBlockType.tpl" />
				<include name="dashboardBoxLinks.tpl" />
				<include name="searchContent.tpl" />
				<include name="__searchAreaSettings.tpl" />
			</tarfileset>
		</tar>
		<tar destfile="metadata/acptemplates_update.b2.tar">
			<tarfileset dir="src/acp/templates">
				<include name="linkCategorySelectOptionType.tpl" />
				<include name="tagInput.tpl" />
				<include name="ultimateContentAdd.tpl" />
				<include name="ultimateContentList.tpl" />
				<include name="ultimateTemplateAdd.tpl" />
			</tarfileset>
		</tar>
		<tar destfile="metadata/files_update.b2.tar">
			<tarfileset dir="src">
				<exclude name="templates/**" />
				<exclude name="acp/templates/**" />
				<include name="**/*.min.js" />
				<include name="**/ULTIMATE.Tagging.js" />
				<include name="**/ULTIMATE.ACP.js" />
				<include name="**/UltimateContent*Form*" />
				<include name="**/UltimateMenuAddForm*" />
				<include name="**/UltimatePageAddForm*" />
				<include name="**/UltimateTemplate*Form*" />
				<include name="**/UltimateWidgetAreaAddForm*" />
				<include name="**/Block.*" />
				<include name="**/BlockAction*" />
				<include name="**/BlockEditor*" />
				<include name="**/ContentAction*" />
				<include name="**/SearchResultContent*" />
				<include name="**/TaggedContentList*" />
				<include name="**/Link.*" />
				<include name="**/Page.*" />
				<include name="**/Template.*" />
				<include name="**/TemplateEditor*" />
				<include name="**/ContentPage*" />
				<include name="**/PagePage*" />
				<include name="**/ULTIMATECore*" />
				<include name="**/AbstractBlockType*" />
				<include name="**/ContentBlockType*" />
				<include name="**/ContentBlockType*" />
				<include name="**/BlockCacheBuilder*" />
				<include name="**/ContentCacheBuilder*" />
				<include name="**/LatestContentsCacheBuilder*" />
				<include name="**/LinkCategoryCacheBuilder*" />
				<include name="**/LatestContents*DashboardBox*" />
				<include name="**/LinkDashboardBox*" />
				<include name="**/UltimateLinkCategorySelectOptionType*" />
				<include name="**/ContentSearch*" />
			</tarfileset>
		</tar>
	</target>
	
	<target name="build" depends="pack" description="Generates the package archive.">
		<tar destfile="build/de.plugins-zum-selberbauen.ultimate.tar" 
			 basedir="metadata"
		/>
		<gzip src="build/de.plugins-zum-selberbauen.ultimate.tar"
			  destfile="build/de.plugins-zum-selberbauen.ultimate.tar.gz"
		/>
	</target>
</project>